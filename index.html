<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç”¢å“æ¸…å–®ç¯©é¸(ä¸»ç·šä»»å‹™3)</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      background: #e0f2fe; /* æŸ”å’Œæ·ºè—åº•è‰²çªé¡¯ */
      color: #333;
    }

    header {
      background: #fff;
      padding: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    header h1 {
      margin: 0;
      font-size: 1.8rem;
      color: #1f2937;
    }
    #healthStatus {
      margin-top: 5px;
      font-size: 0.9rem;
      color: #4b5563;
    }

    main {
      max-width: 1200px;
      margin: 30px auto;
      padding: 0 20px;
    }

    /* ç¯©é¸å€ */
    #filterBox {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      margin-bottom: 30px;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 12px;
    }
    #filterBox label {
      font-weight: 500;
      margin-right: 6px;
    }
    #filterBox input, #filterBox select {
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
      width: 120px;
      transition: 0.2s;
    }
    #filterBox input:focus, #filterBox select:focus {
      border-color: #3b82f6;
      outline: none;
    }
    #filterBox button {
      display: none; /* ä¸éœ€è¦æŒ‰éˆ•ï¼Œæ”¹æˆå³æ™‚ç¯©é¸ */
    }

    /* ç”¢å“åˆ—è¡¨ */
    #products {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 20px;
    }
    .product {
      background: #fff;
      padding: 16px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .product:hover {
      transform: translateY(-4px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .product h3 {
      margin: 0 0 8px;
      font-size: 1.1rem;
      color: #111827;
    }
    .product p {
      margin: 0;
      font-weight: 500;
      color: #3b82f6;
    }

    /* éŒ¯èª¤è¨Šæ¯ / ç„¡ç”¢å“æç¤º */
    .error, #products p {
      grid-column: 1 / -1;
      color: red;
      text-align: center;
      font-weight: 500;
      padding: 20px;
    }

    /* RWD */
    @media(max-width: 768px){
      #filterBox {
        flex-direction: column;
        align-items: flex-start;
      }
      #filterBox input, #filterBox select {
        width: 100%;
      }
      #products {
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      }
    }
    @media(max-width: 480px){
      header h1 {
        font-size: 1.4rem;
      }
      #filterBox {
        padding: 16px;
      }
      .product {
        padding: 12px;
      }
    }
  </style>
</head>

<body>
  <header>
    <h1>ğŸ›’ ç³»çµ±ç‹€æ…‹ & ç”¢å“æ¸…å–®</h1>
    <div id="healthStatus">
      <strong>ç³»çµ±å¥åº·ç‹€æ…‹ï¼š</strong><span id="statusText">è®€å–ä¸­â€¦</span>
    </div>
  </header>

  <main>
    <!-- åƒ¹æ ¼ç¯©é¸ + æ’åº -->
    <div id="filterBox">
      <label>æœ€ä½åƒ¹ï¼š</label>
      <input type="number" id="minPrice" placeholder="ä¾‹ï¼š1000">

      <label>æœ€é«˜åƒ¹ï¼š</label>
      <input type="number" id="maxPrice" placeholder="ä¾‹ï¼š5000">

      <label>æ’åºï¼š</label>
      <select id="sortSelect">
        <option value="">ä¸æ’åº</option>
        <option value="asc">åƒ¹æ ¼ä½ â†’ é«˜</option>
        <option value="desc">åƒ¹æ ¼é«˜ â†’ ä½</option>
      </select>
    </div>

    <!-- ç”¢å“æ¸…å–® -->
    <div id="productsContainer">
      <h2>ç”¢å“æ¸…å–®</h2>
      <div id="products"></div>
    </div>
  </main>

  <script>
    const apiProducts = "https://jringyou.zeabur.app/api/products";
    const apiHealth = "https://jringyou.zeabur.app/api/health";

    const list = document.getElementById("products");

    // å¥åº·æª¢æŸ¥
    fetch(apiHealth)
      .then(res => res.json())
      .then(data => {
        document.getElementById("statusText").textContent =
          data.status + "ï¼ˆ" + data.timestamp + "ï¼‰";
      })
      .catch(() => {
        document.getElementById("statusText").textContent = "è®€å–å¤±æ•—";
      });

    // è®€å–ç”¢å“
    async function loadProducts() {
      const min = document.getElementById("minPrice").value;
      const max = document.getElementById("maxPrice").value;
      const sort = document.getElementById("sortSelect").value;

      const params = new URLSearchParams();
      if (min) params.append("min", min);
      if (max) params.append("max", max);

      let url = apiProducts;
      if (params.toString()) url += "?" + params.toString();

      try {
        const res = await fetch(url);
        let products = await res.json();

        if (!Array.isArray(products.matchedProducts) || products.matchedProducts.length === 0) {
          list.innerHTML = "<p>æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„ç”¢å“ã€‚</p>";
          return;
        }

        // æ’åº
        if (sort === "asc") products.matchedProducts.sort((a,b)=>a.price-b.price);
        else if (sort === "desc") products.matchedProducts.sort((a,b)=>b.price-a.price);

        list.innerHTML = "";
        products.matchedProducts.forEach(p => {
          const item = document.createElement("div");
          item.className = "product";
          item.innerHTML = `
            <h3>${p.name}</h3>
            <p>NT$ ${p.price.toLocaleString()}</p>
          `;
          list.appendChild(item);
        });
      } catch {
        list.innerHTML = "<p class='error'>è®€å–ç”¢å“å¤±æ•—ã€‚</p>";
      }
    }

    // å³æ™‚ç¯©é¸ & æ’åº
    ["minPrice","maxPrice","sortSelect"].forEach(id=>{
      document.getElementById(id).addEventListener("input", loadProducts);
      document.getElementById(id).addEventListener("change", loadProducts);
    });

    // åˆå§‹åŒ–
    loadProducts();
  </script>
</body>
</html>
